var progressContainer=$(".progress");var progressbar=$(".progress-bar");loadImageList("all");function upload(a){var b=new FormData();b.append("file",a);$.ajax({url:window.location.href+"/do_upload",data:b,cache:false,contentType:false,processData:false,type:"post",xhr:function(){var c=null;if(window.ActiveXObject){c=new window.ActiveXObject("Microsoft.XMLHTTP")}else{c=new window.XMLHttpRequest()}progressContainer.show();progressbar.show();c.upload.addEventListener("progress",countProgress,false);return c},success:function(){},error:function(c){alert("error");console.log(c)}}).done(function(c){console.log("done");setTimeout(function(){showProgress(0);progressContainer.hide();progressbar.hide();loadImageList("last")},2500)})}function countProgress(a){if(a.lengthComputable){var b=Math.round((a.loaded*100)/a.total);showProgress(b);console.log("Uploaded percent",b)}}function showProgress(a){progressbar.attr("aria-valuenow",a);progressbar.css("width",a+"%");progressbar.text(a+"%")}function handleFileSelect(a){a.stopPropagation();a.preventDefault();var c=a.dataTransfer.files;if(c.length>1){alert("too many files")}for(var b=0,d;d=c[b];b++){console.log(d);upload(d)}}function handleDragOver(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"}var dropZone=document.getElementById("dropzone");dropZone.addEventListener("dragover",handleDragOver,false);dropZone.addEventListener("drop",handleFileSelect,false);var fileInput=document.getElementById("file-input");fileInput.addEventListener("change",function(b){var a=fileInput.files;upload(a[0])},false);function loadImageList(a){$.ajax({url:window.location.href+"/list_uploads",data:{},cache:false,contentType:false,processData:false,success:function(b){console.log("success")}}).done(function(b){var d=JSON.parse(b);var c=$.map(d,function(f,e){return[f]});showImages(c,a)})}function showImage(b,c){var d=window.location.origin+"/images/uploads/"+c;var a=$('<div class="gallery-col col-md-2 col-sm-4 col-xs-6"><a href="'+d+'" target="_blank"><img class="img-responsive" src="'+d+'"></a></div>');a.show();b.append(a)}function showImages(d,c){var a=$(".gallery-row");if(c==="all"){for(var b=0;b<d.length;b++){showImage(a,d[b])}}if(c==="last"){showImage(a,d[d.length-1])}};